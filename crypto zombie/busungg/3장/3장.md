# 컨트랙트

### 1. 컨트랙트의 불변성

1. 컨트랙트의 불변성  
   이더리움에 컨트랙트를 배포하고 나면, 컨트랙트는 변하지 않는다(Immutable)  
   즉 컨트랙트를 수정하거나 업데이트 할 수 없습니다.  
   컨트랙트로 배포한 최초의 코드는 항상, 블록체인에 영구적으로 존재하며, 이것이 바로 솔리디티에 있어서 보안이 굉장히 큰 이슈인 이유입니다.

2. 컨트랙트의 외부 의존성  
   만약 컨트랙트에 버그가 있다고 할 시 그걸 곷이기 위해 컨트랙트를 수정할 수 있도록 만드는 것이 중요하다.

### 2. 소유 가능한 컨트랙트

1. 이전 크립토키티 컨트랙트 주소를 변경하는 함수는 누구든 호출할 수 있기 때문에  
   아무나 이 함수를 호출해서 크립토키티 컨트랙트의 주소를 변경하거나 우리 앱을 무용지물로 만들 수 있습니다.  
   이런 문제점을 해결하기 위해 최근에 주로 쓰는 하나의 방법은 컨트랙트를 소유 가능하게 만드는 것입니다.

2. OpenZeppelin의 Ownable 컨트랙트  
   OpenZeppelin은 DApp에서 사용할 수 있는, 안전하고 커뮤니티에서 검증받은 스마트 컨트랙트의 라이브러리입니다.

   ```
      /**
      * @title Ownable
      * @dev The Ownable contract has an owner address, and provides basic authorization control
      * functions, this simplifies the implementation of "user permissions".
      */
      contract Ownable {
         address public owner;
         event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);

         /**
            * @dev The Ownable constructor sets the original `owner` of the contract to the sender
            * account.
            */
         function Ownable() public {
            owner = msg.sender;
         }

         /**
            * @dev Throws if called by any account other than the owner.
            */
         modifier onlyOwner() {
            require(msg.sender == owner);
            _;
         }

         /**
            * @dev Allows the current owner to transfer control of the contract to a newOwner.
            * @param newOwner The address to transfer ownership to.
            */
         function transferOwnership(address newOwner) public onlyOwner {
            require(newOwner != address(0));
            OwnershipTransferred(owner, newOwner);
            owner = newOwner;
         }
      }
   ```

   - 생성자(Constructor): function Ownable() 생성자  
      컨트랙트와 동일한 이름을 가진, 생략할 수 있는 특별한 함수입니다. 이 함수는 컨트랙트가 생성될 때 딱 한 번만 실행됩니다.
   - 함수 제어자(Function Modifier): modifier onlyOwner()  
      제어자는 다른 함수들에 대한 접근을 제어하기 위해 사용되는 일종의 유사 함수입니다.  
      보통 함수 실행 전의 요구사항 충족 여부를 확인하는 데에 사용합니다.  
      onlyOwner의 경우에는 접근을 제한해서 오직 컨트랙트의 소유자만 해당 함수를 실행 할 수 있도록 하기 위해 사용될 수 있습니다. 우리는 다음 챕터에서 함수제어자에 대해 더 살펴보고, \_;라는 것에 대해 알아볼 것입니다.
   - indexed 키워드: 추후에 알아볼 것입니다.

   Ownable 컨트랙트는 기본적으로 다음과 같은 것들을 합니다.

   - 컨트랙트가 생성되면 컨트랙트의 생성자가 owner에 msg.sender(컨트랙트를 배포한 사람)를 대입합니다.
   - 특정한 함수들에 대해서 오직 소유자만 접근할 수 있도록 제한 가능한 onlyOwner 제어자를 추가합니다.
   - 새로운 소유자에게 해당 컨트랙트의 소유권을 옮길 수 있도록 합니다.

   onlyOwner는 컨트랙트에서 흔히 쓰는 것 중 하나라, 대부분의 솔리디티 DApp들은 Ownable 컨트랙트를 복사/붙여넣기 하면서 시작합니다. 그리고 첫 컨트랙트는 이 컨트랙트를 상속해서 만듭니다.
